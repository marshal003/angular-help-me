/**
 * angular-help-me
 * @version v0.0.0 - 2015-10-25
 * @link https://github.com/marshal003/angular-help-me
 * @author Vinit Kumar Rai <vinitrai.marshal@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("hiComponents.helpMe",[]).value("hiHelpDB",{aboutHelp:"The help DB will contain a JSON of key value pair, that would be used       to display help content. Use help-text directive by passing the key to get the help content."}).service("hiHelpDBService",["hiHelpDB",function(a){return{get:function(){return a}}}]).service("hiHelpDesk",["$rootScope","$templateCache","hiHelpDBService","$q",function(a,b,c,d){var e={},f=!0,g=null,h="helpMe.directiveHTML",i=function(a){return angular.isDefined(g)&&g in e?e[g][a]:e[a]},j=function(){f=!f,a.$broadcast("hihelpMe-toggle-help-text")},k=function(){return f},l=function(b){f=b,a.$broadcast("hihelpMe-toggle-help-text")},m=function(a){b.put(h,a)},n=function(a){return a||(a=h),b.get(a)},o=function(){b.get(h)||m('<span class="help-block" ng-show="showHelpText" ng-bind="helpText"></span>'),r(c.get())},p=function(b){g=b,a.$broadcast("hihelpMe-on-locale-change")},q=function(a,b){for(var c in b)c in a&&angular.isObject(b[c])?q(a[c],b[c]):a[c]=b[c]},r=function(b){d.when(b).then(function(b){q(e,b),a.$broadcast("hihelpMe-on-db-change")})},s=function(b,c,d){angular.isDefined(d)?(d in e||(e[d]={}),e[d][b]=c):e[b]=c,a.$broadcast("hihelpMe-on-db-update")};return o(),{addHelpText:s,getHelpForKey:i,toggleHelpText:j,isHelpModeOn:k,setHelpMode:l,setHelpTemplate:m,getHelpTemplate:n,setHelpDatabase:r,setLocale:p}}]).directive("hiHelpText",function(){return{scope:!0,restrict:"A",controller:["$scope","$compile","hiHelpDesk","$log",function(a,b,c,d){a.helpKey="",a.getHelpElement=function(d,e){a.helpKey=d,a.helpText=c.getHelpForKey(d),a.showHelpText=c.isHelpModeOn()&&a.helpText;var f=angular.element(c.getHelpTemplate(e));return b(f)(a)},a.$on("hihelpMe-toggle-help-text",function(){a.showHelpText=c.isHelpModeOn()&&a.helpText}),a.$on("hihelpMe-on-locale-change",function(){a.helpText=c.getHelpForKey(a.helpKey),a.showHelpText=c.isHelpModeOn()&&a.helpText}),a.$on("hihelpMe-on-db-change",function(){a.helpText=c.getHelpForKey(a.helpKey),a.showHelpText=c.isHelpModeOn()&&a.helpText}),a.$on("hihelpMe-on-db-update",function(b,d){d.key===a.helpKey&&(a.helpText=c.getHelpForKey(a.helpKey),a.showHelpText=c.isHelpModeOn()&&a.helpText)})}],link:function(a,b,c){if(""!==c.hiHelpText){var d=function(){var a=["input","select","textarea"],c=b.prop("tagName").toLowerCase();return-1===a.indexOf(c)},e=function(){var e=a.getHelpElement(c.hiHelpText,c.hiHelpTpl);d()?b.append(e):b.after(e)};e()}}}});